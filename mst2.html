<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ¦‚æ•¸é­”ç‹æŒ‘æˆ° - 2026 æ•¸ä½å­¸ç¿’ç‰ˆ</title>
    <link rel="stylesheet" href="ms.css">
    <style>
        /* é€ƒé›¢æˆ°å ´æŒ‰éˆ•æ¨£å¼ */
.home-float {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 100;
    background: var(--primary); /* ä½¿ç”¨æ‚¨å®šç¾©çš„å­¸ç¿’ç´«è‰² */
    color: white;
    padding: 12px 24px;
    border-radius: 50px;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 2px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    gap: 8px;
    backdrop-filter: blur(10px);
}

.home-float:hover {
    transform: scale(1.1) rotate(-3deg);
    background: #5649c0;
    box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
    border-color: var(--accent); /* æ‡¸æµ®æ™‚é‚Šæ¡†è®Šé»ƒè‰² */
}

.home-float:active {
    transform: scale(0.95);
}
        /* æˆ°é¬¥å°ˆç”¨ä½ˆå±€ */
        .battle-wrapper {
            position: relative; z-index: 2;
            max-width: 800px; margin: 20px auto;
            padding: 0 20px;
        }

        /* é ‚éƒ¨è¡€é‡æ¢ (HP) */
        .status-header {
            display: flex; justify-content: space-between; gap: 20px;
            background: rgba(0, 0, 0, 0.7); padding: 20px;
            border-radius: 25px; backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .hp-group { flex: 1; }
        .hp-label { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; }
        .hp-bar-bg { height: 14px; background: #222; border-radius: 10px; overflow: hidden; border: 1px solid #444; }
        .hp-fill { height: 100%; transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        #playerHpFill { background: linear-gradient(90deg, #00b894, #55efc4); box-shadow: 0 0 10px #00b894; }
        #enemyHpFill { background: linear-gradient(90deg, #ff7675, #d63031); box-shadow: 0 0 10px #ff7675; }

        /* é­”ç‹å‹•ç•«å€ */
        .boss-area {
            height: 250px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; position: relative;
        }
        .boss-sprite {
            font-size: 8rem; filter: drop-shadow(0 0 20px rgba(255,255,255,0.2));
            animation: bossFloat 3s infinite ease-in-out; transition: 0.2s;
        }
        @keyframes bossFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* é¡Œç›®èˆ‡æŒ‡ä»¤å¡ç‰‡ */
        .action-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px); border-radius: 30px;
            padding: 30px; text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* å››é¸ä¸€æŒ‰éˆ•ç¶²æ ¼ */
        .options-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;
        }
        .opt-btn {
            background: rgba(108, 92, 231, 0.2); border: 2px solid var(--primary);
            color: white; padding: 18px; border-radius: 15px; font-size: 1.4rem;
            cursor: pointer; transition: all 0.3s; font-weight: bold;
        }
        .opt-btn:hover { background: var(--primary); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .opt-btn:active { transform: scale(0.95); }

        /* æˆ°é¬¥å‚·å®³å­—é«” */
        .damage-txt {
            position: absolute; font-size: 3rem; font-weight: 900;
            pointer-events: none; animation: damageFly 0.8s forwards; z-index: 10;
        }
        @keyframes damageFly { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: translateY(-100px) scale(1.5); } }

        /* éŒ¯èª¤è§£æè¦†è“‹å±¤ */
        #errorOverlay {
            display: none; position: fixed; inset: 0; background: rgba(214, 48, 49, 0.96);
            z-index: 1000; align-items: center; justify-content: center; padding: 30px;
        }
        .error-box { background: white; color: #333; padding: 40px; border-radius: 30px; max-width: 500px; text-align: center; }
        
        /* å—å‚·éœ‡å‹•å‹•ç•« */
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 20% { transform: translate(-5px, 5px); } 40% { transform: translate(5px, -5px); } 60% { transform: translate(-5px, -5px); } 80% { transform: translate(5px, 5px); } }
    </style>
</head>
<body>
    <canvas id="mathBackground"></canvas>
    <a href="ms.html" class="home-float">ğŸ  é€ƒé›¢æˆ°é¬¥</a>

    <div class="battle-wrapper">
        <!-- è¡€é‡é¡¯ç¤ºæ¬„ -->
        <div class="status-header">
            <div class="hp-group">
                <div class="hp-label"><span>å‹‡è€… (HP)</span><span id="pHpTxt">7 / 7</span></div>
                <div class="hp-bar-bg"><div id="playerHpFill" class="hp-fill" style="width: 100%"></div></div>
            </div>
            <div class="hp-group">
                <div class="hp-label"><span>é­”ç‹ (HP)</span><span id="eHpTxt">9 / 9</span></div>
                <div class="hp-bar-bg"><div id="enemyHpFill" class="hp-fill" style="width: 100%"></div></div>
            </div>
        </div>

        <!-- é­”ç‹å‹•ç•«å€ -->
        <div class="boss-area" id="bossZone">
            <div id="boss" class="boss-sprite">ğŸ‘¹</div>
        </div>

        <!-- æˆ°é¬¥æŒ‡ä»¤(é¡Œç›®)å€ -->
        <div class="action-card">
            <h3 id="modeTitle" style="color: var(--accent); margin:0;">æº–å‚™é€²å…¥æˆ°é¬¥...</h3>
            <div id="qContent" style="font-size: 1.8rem; margin: 20px 0; font-weight: bold;"></div>
            <div class="options-grid" id="optionsGroup">
                <!-- ç”± JS å‹•æ…‹ç”Ÿæˆ 4 å€‹æŒ‰éˆ• -->
            </div>
        </div>
    </div>

    <!-- ç­”éŒ¯æ™‚çš„è§£æå½ˆçª— -->
    <div id="errorOverlay">
        <div class="error-box">
            <h1 style="color: #d63031; margin-top: 0;">ğŸ’¥ è¢«é­”ç‹åæ“Šï¼</h1>
            <p id="errorExp" style="font-size: 1.3rem; line-height: 1.6; margin: 20px 0;"></p>
            <button onclick="closeError()" class="tab-btn active" style="width:100%; background:#d63031; border:none; padding:15px; color:white; border-radius:10px; cursor:pointer;">é‡æ•´æ——é¼“</button>
        </div>
    </div>

    <script src="ms.js"></script>
    <script>
        // è¨­å®šéŠæˆ²æ•¸å€¼ï¼šå‹åˆ©éœ€ç­”å° 9 é¡Œï¼Œå¤±æ•— 7 é¡Œå‰‡çµæŸ
        let pHp = 7, pMax = 7;
        let eHp = 9, eMax = 9;
        let currentCorrectAns = 0;
        let currentExp = "";

        const bossIcons = ['ğŸ‘¹', 'ğŸ‰', 'ğŸ‘¾', 'ğŸ‘¿', 'ğŸ¤–'];

        function nextRound() {
            if (pHp <= 0 || eHp <= 0) return;

            // 1. ç”Ÿæˆ 100k ä»¥å…§çš„éš¨æ©Ÿé¡Œç›®
            const n = Math.floor(Math.random() * 90000) + 10000; 
            const modes = ['ceil', 'floor', 'round'];
            const m = modes[Math.floor(Math.random() * 3)];
            const targets = [{n:'åä½',v:10}, {n:'ç™¾ä½',v:100}, {n:'åƒä½',v:1000}, {n:'è¬ä½',v:10000}];
            const t = targets[Math.floor(Math.random() * 4)];

            const modeNames = {ceil:'ç„¡æ¢ä»¶é€²ä½', floor:'ç„¡æ¢ä»¶æ¨å»', round:'å››æ¨äº”å…¥'};
            document.getElementById('modeTitle').innerText = `ã€${modeNames[m]}æ”»æ“Šã€‘`;
            document.getElementById('qContent').innerHTML = `å°‡ <span class="highlight">${n.toLocaleString()}</span> å–åˆ° <span class="highlight">${t.n}</span>`;

            // 2. è¨ˆç®—æ­£ç¢ºç­”æ¡ˆèˆ‡è§£æ
            let ans = 0;
            if(m === 'ceil') {
                ans = (n % t.v === 0) ? n : (Math.floor(n/t.v)*t.v + t.v);
                currentExp = `è§£æï¼šå–åˆ°${t.n}ï¼Œå¾Œæ–¹ä¸ç‚º0å°±è¦é€²ä½ã€‚${n.toLocaleString()} çš„ ${t.n} å¾Œé¢é‚„æœ‰æ•¸å­—ï¼Œæ‰€ä»¥å‰ä¸€ä½è¦åŠ  1ã€‚ç­”æ¡ˆï¼š${ans.toLocaleString()}`;
            } else if(m === 'floor') {
                ans = Math.floor(n/t.v)*t.v;
                currentExp = `è§£æï¼šå–åˆ°${t.n}ï¼Œä¸è«–å¾Œé¢æ•¸å­—æ˜¯å¤šå°‘ï¼Œé€šé€šè®Šæˆ 0ã€‚ç­”æ¡ˆï¼š${ans.toLocaleString()}`;
            } else {
                ans = Math.round(n / t.v) * t.v;
                const next = Math.floor((n % t.v) / (t.v / 10));
                currentExp = `è§£æï¼šå–åˆ°${t.n}è¦çœ‹ä¸‹ä¸€ä½ã€‚ä¸‹ä¸€ä½æ˜¯ ${next}ï¼Œ${next>=5?'æ»¿ 5 æ‰€ä»¥é€²ä½':'ä¸æ»¿ 5 ç›´æ¥æ¨å»'}ã€‚ç­”æ¡ˆï¼š${ans.toLocaleString()}`;
            }
            currentCorrectAns = ans;

            // 3. ç”Ÿæˆ 4 å€‹é¸é … (æ­£ç¢º 1 å€‹ + æ··æ·† 3 å€‹)
            let opts = new Set([ans]);
            while(opts.size < 4) {
                // ç”¢ç”Ÿæ¥è¿‘æ­£ç¢ºç­”æ¡ˆçš„å¹²æ“¾æ•¸å­—
                let offset = (Math.floor(Math.random() * 5) - 2) * t.v;
                let fake = ans + offset;
                if(fake > 0 && fake !== ans) opts.add(fake);
            }

            const grid = document.getElementById('optionsGroup');
            grid.innerHTML = "";
            // å°‡é¸é …æ´—ç‰Œå¾Œé¡¯ç¤º
            [...opts].sort(() => Math.random() - 0.5).forEach(val => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = val.toLocaleString();
                btn.onclick = () => handleChoice(val);
                grid.appendChild(btn);
            });
        }

        function handleChoice(val) {
            if (val === currentCorrectAns) {
                // ç­”å°ï¼šé­”ç‹æ‰£è¡€
                eHp--;
                createPopText("CRITICAL HIT!", "#f1c40f", "bossZone");
                const b = document.getElementById('boss');
                b.style.transform = "scale(0.7) translateX(30px)";
                b.style.filter = "brightness(5) hue-rotate(90deg)";
                setTimeout(() => { b.style.transform = ""; b.style.filter = ""; }, 200);
                if(typeof createConfetti === 'function') createConfetti(window.innerWidth/2, window.innerHeight/3);
            } else {
                // ç­”éŒ¯ï¼šå‹‡è€…æ‰£è¡€ä¸¦å½ˆå‡ºè§£æ
                pHp--;
                createPopText("OUCH!", "#ff7675", "playerHpFill");
                document.getElementById('errorExp').innerText = currentExp;
                document.getElementById('errorOverlay').style.display = 'flex';
                document.body.style.animation = "shake 0.3s ease-in-out";
                setTimeout(()=> document.body.style.animation = "", 300);
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('pHpTxt').innerText = `${pHp} / ${pMax}`;
            document.getElementById('eHpTxt').innerText = `${eHp} / ${eMax}`;
            document.getElementById('playerHpFill').style.width = (pHp/pMax*100) + "%";
            document.getElementById('enemyHpFill').style.width = (eHp/eMax*100) + "%";

            if (eHp <= 0) {
                alert("ğŸ‰ å‹åˆ©ï¼ä½ æˆåŠŸæ“Šæ•—äº†æ¦‚æ•¸é­”ç‹ï¼");
                location.href = 'ms.html';
            } else if (pHp <= 0) {
                alert("ğŸ’€ æˆ°æ•—... å›å»å¤šç·´ç¿’æ¦‚æ•¸è§€å¿µå§ï¼");
                location.href = 'ms.html';
            } else if (document.getElementById('errorOverlay').style.display !== 'flex') {
                nextRound();
            }
        }

        function createPopText(txt, color, targetId) {
            const div = document.createElement('div');
            div.className = 'damage-txt';
            div.innerText = txt;
            div.style.color = color;
            document.getElementById(targetId).appendChild(div);
            setTimeout(() => div.remove(), 800);
        }

        function closeError() {
            document.getElementById('errorOverlay').style.display = 'none';
            nextRound();
        }

        window.onload = () => {
            // åˆå§‹åŒ–åŸæœ‰çš„ Canvas èƒŒæ™¯ç‰¹æ•ˆ
            if(typeof init === 'function') init(); 
            // éš¨æ©Ÿé¸ä¸€å€‹é­”ç‹åœ–ç¤º
            document.getElementById('boss').innerText = bossIcons[Math.floor(Math.random()*bossIcons.length)];
            nextRound();
        };
    </script>
</body>
</html>
